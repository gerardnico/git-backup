#!/bin/bash
# @name Git Acp
# @brief Add, Commit and Push at once
# @description
#
#    A commit utility function for `Git Add, Commit and Push`
#
#    ## Example
#
#    * For one repository
#
#    ```bash
#    git acp "My Commit Message"
#    ```
#
#    * For all repositories under the repo home directory with `git exec`
#
#    ```bash
#    git exec acp "My Commit Message"
#    ```
#
#    ## Syntax
#
#    ```bash
#    git acp <Commit Message>
#    ```
#



source bashlib-echo.sh

if [ "${1:-}" = "" ]; then
    echo::err "A commit message is mandatory"
    exit 1
fi

# `--renormalize` to correct the EOL in the working tree
git add --renormalize .
# renormalize does not add any file into the index
# we need to add it twice
git add .
git commit -v -a -m "$1"
git push
